(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[220],{7180:function(e,t,r){Promise.resolve().then(r.bind(r,1518))},1518:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return y}});var n=r(7437),a=r(2265),s=r(6070),o=r(5974),i=r(6109),c=r(801),l=r(9205);let d=(0,l.Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),u=(0,l.Z)("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);var m=r(8226);let f=(0,l.Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);var h=r(9116),x=r(6023);function y(){let[e,t]=(0,a.useState)(null),[r,l]=(0,a.useState)(!1),[y,v]=(0,a.useState)(null),p=(0,x.vF)();(0,a.useEffect)(()=>{if(!(null==p?void 0:p.user_id))return;let e=!0;return l(!0),v(null),(0,h.U2)("/transactions/user/".concat(p.user_id)).then(r=>{e&&t(Array.isArray(r)?r:[])}).catch(r=>{console.error("fetch transactions",r),e&&(v((null==r?void 0:r.message)||JSON.stringify(r)),t([]))}).finally(()=>e&&l(!1)),()=>{e=!1}},[null==p?void 0:p.user_id]);let g=(0,a.useMemo)(()=>{if(!e)return 0;let t=new Date().toISOString().slice(0,10);return e.filter(e=>(e.created_at||"").slice(0,10)===t&&("success"===e.payment_status||"completed"===e.payment_status)).reduce((e,t)=>e+(t.amount||0),0)},[e]);async function b(e){try{let r=await (0,h.v_)("/transactions/".concat(e,"/confirm"),{});t(t=>t?t.map(t=>t.transaction_id===e?r:t):t)}catch(e){alert("Failed to confirm payment: "+((null==e?void 0:e.message)||JSON.stringify(e)))}}if(!(null==p?void 0:p.user_id))return(0,n.jsxs)(i.O,{children:[(0,n.jsxs)("header",{className:"bg-primary text-primary-foreground p-6 shadow-md",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"Transactions"}),(0,n.jsx)("p",{className:"text-primary-foreground/90 mt-1",children:"Please sign in to view your transactions"})]}),(0,n.jsx)("div",{className:"p-6",children:"Please log in to continue."})]});let j=(null==p?void 0:p.role)==="passenger";return(0,n.jsxs)(i.O,{children:[(0,n.jsxs)("header",{className:"bg-primary text-primary-foreground p-6 shadow-md",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"Transactions"}),(0,n.jsx)("p",{className:"text-primary-foreground/90 mt-1",children:"Your payment history"})]}),(0,n.jsxs)("div",{className:"p-6 space-y-6",children:[(0,n.jsx)(s.Zb,{className:"shadow-lg bg-gradient-to-br from-secondary to-secondary/80 text-secondary-foreground border-0",children:(0,n.jsx)(s.aY,{className:"pt-6",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-secondary-foreground/80 text-sm font-medium mb-1",children:j?"Today's Total Expenses":"Today's Total Earnings"}),(0,n.jsxs)("p",{className:"text-3xl font-bold",children:["₱",g]})]}),(0,n.jsx)("div",{className:"p-3 bg-secondary-foreground/10 rounded-full",children:(0,n.jsx)(d,{className:"h-8 w-8"})})]})})}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("h2",{className:"text-lg font-bold text-foreground",children:"Transaction History"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground -mt-2",children:"Transaction records are permanent and cannot be deleted"}),r&&(0,n.jsx)("div",{className:"py-6",children:"Loading transactions..."}),y&&(0,n.jsxs)("div",{className:"text-destructive",children:["Error: ",y]}),!r&&e&&0===e.length&&(0,n.jsx)("div",{className:"py-6 text-muted-foreground",children:"No transactions found."}),null==e?void 0:e.map(e=>{let t=e.created_at?new Date(e.created_at).toLocaleString():"-",r="cash"===(e.payment_mode||"").toLowerCase(),a="success"===(e.payment_status||"").toLowerCase()||"completed"===(e.payment_status||"").toLowerCase();return(0,n.jsxs)(s.Zb,{className:"shadow-lg",children:[(0,n.jsx)(s.Ol,{className:"pb-3",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(s.ll,{className:"text-base font-mono",children:e.transaction_id}),(0,n.jsx)(o.C,{variant:a?"default":"secondary",className:a?"bg-secondary":"",children:e.payment_status})]})}),(0,n.jsxs)(s.aY,{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[r?(0,n.jsx)(u,{className:"h-4 w-4"}):(0,n.jsx)(m.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:e.payment_mode})]}),(0,n.jsx)("span",{className:"text-muted-foreground",children:t})]}),(0,n.jsxs)("div",{className:"pt-2 border-t border-border",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Amount"}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(f,{className:"h-5 w-5 text-secondary"}),(0,n.jsxs)("span",{className:"text-xl font-bold text-foreground",children:["₱",e.amount]})]})]}),r&&!a&&(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsx)("button",{onClick:()=>b(e.transaction_id),className:"px-3 py-2 bg-primary text-white rounded-md",children:"Confirm cash payment"})})]})]})]},e.transaction_id)})]})]}),(0,n.jsx)(c.L,{})]})}},801:function(e,t,r){"use strict";r.d(t,{L:function(){return m}});var n=r(7437),a=r(7648),s=r(9376),o=r(7877),i=r(1047);let c=(0,r(9205).Z)("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);var l=r(8226),d=r(2369),u=r(4508);function m(e){let{userType:t}=e,r=(0,s.usePathname)(),m=t;if(!m)try{let e=localStorage.getItem("tricy_user"),t=e?JSON.parse(e):null;(null==t?void 0:t.role)&&(m=t.role)}catch(e){}let f="driver"===m?"/driver":"/passenger",h="driver"===m?"Active rides":"Bookings",x=[{href:f,icon:c,label:"Home"},{href:"/bookings",icon:"driver"===m?o.Z:i.Z,label:h},{href:"/transactions",icon:l.Z,label:"Transactions"},{href:"/profile",icon:d.Z,label:"Profile"}];return(0,n.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 bg-card border-t border-border shadow-lg z-50",children:(0,n.jsx)("div",{className:"max-w-md mx-auto flex justify-around items-center h-16 px-4",children:x.map(e=>{let t=e.icon,s=r===e.href;return(0,n.jsxs)(a.default,{href:e.href,className:(0,u.cn)("flex flex-col items-center justify-center gap-1 flex-1 h-full transition-colors",s?"text-primary":"text-muted-foreground"),children:[(0,n.jsx)(t,{className:"h-5 w-5"}),(0,n.jsx)("span",{className:"text-xs font-medium",children:e.label})]},e.href)})})})}},6109:function(e,t,r){"use strict";r.d(t,{O:function(){return s}});var n=r(7437),a=r(4508);function s(e){let{children:t,className:r}=e;return(0,n.jsx)("div",{className:(0,a.cn)("min-h-screen bg-background pb-20",r),children:(0,n.jsx)("div",{className:"max-w-md mx-auto",children:t})})}},5974:function(e,t,r){"use strict";r.d(t,{C:function(){return c}});var n=r(7437);r(2265);var a=r(8482),s=r(535),o=r(4508);let i=(0,s.j)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:r,asChild:s=!1,...c}=e,l=s?a.g7:"span";return(0,n.jsx)(l,{"data-slot":"badge",className:(0,o.cn)(i({variant:r}),t),...c})}},6070:function(e,t,r){"use strict";r.d(t,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return s},aY:function(){return l},ll:function(){return i}});var n=r(7437);r(2265);var a=r(4508);function s(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function o(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function i(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",t),...r})}function c(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",t),...r})}function l(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",t),...r})}},9116:function(e,t,r){"use strict";r.d(t,{U2:function(){return o},r$:function(){return i},v_:function(){return s}});let n=r(257).env.NEXT_PUBLIC_API_BASE||"https://kadzysakatna.onrender.com";function a(){try{return localStorage.getItem("tricy_token")}catch(e){return null}}async function s(e,t){let r=a(),s={"Content-Type":"application/json"};r&&(s.Authorization="Bearer ".concat(r));let o=await fetch("".concat(n).concat(e),{method:"POST",headers:s,body:JSON.stringify(t)});if(401===o.status){try{localStorage.removeItem("tricy_token"),localStorage.removeItem("tricy_user"),window.dispatchEvent(new CustomEvent("tricy_logout"))}catch(e){}throw{message:"Unauthorized",status:401}}let i=await o.json().catch(()=>null);if(!o.ok)throw i||{message:o.statusText};return i}async function o(e){let t=a(),r={"Content-Type":"application/json"};t&&(r.Authorization="Bearer ".concat(t));let s=await fetch("".concat(n).concat(e),{headers:r});if(401===s.status){try{localStorage.removeItem("tricy_token"),localStorage.removeItem("tricy_user"),window.dispatchEvent(new CustomEvent("tricy_logout"))}catch(e){}throw{message:"Unauthorized",status:401}}let o=await s.json().catch(()=>null);if(!s.ok)throw o||{message:s.statusText};return o}async function i(e,t){let r=a(),s={"Content-Type":"application/json"};r&&(s.Authorization="Bearer ".concat(r));let o=await fetch("".concat(n).concat(e),{method:"PATCH",headers:s,body:JSON.stringify(t)});if(401===o.status){try{localStorage.removeItem("tricy_token"),localStorage.removeItem("tricy_user"),window.dispatchEvent(new CustomEvent("tricy_logout"))}catch(e){}throw{message:"Unauthorized",status:401}}let i=await o.json().catch(()=>null);if(!o.ok)throw i||{message:o.statusText};return i}},6023:function(e,t,r){"use strict";r.d(t,{M8:function(){return o},kS:function(){return s},vF:function(){return a}});var n=r(9116);function a(){let e=localStorage.getItem("tricy_user");return e?JSON.parse(e):null}function s(){localStorage.removeItem("tricy_token"),localStorage.removeItem("tricy_user"),window.dispatchEvent(new CustomEvent("tricy_logout"))}async function o(e){let t=a(),r=null!=e?e:null==t?void 0:t.user_id;if(!r)return null;try{return await (0,n.U2)("/users/".concat(r))}catch(e){return console.error("fetchUserFromApi",e),null}}},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return s}});var n=r(1994),a=r(3335);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},1047:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},8226:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},7877:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]])},2369:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},7648:function(e,t,r){"use strict";r.d(t,{default:function(){return a.a}});var n=r(2972),a=r.n(n)},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[998,972,971,117,744],function(){return e(e.s=7180)}),_N_E=e.O()}]);
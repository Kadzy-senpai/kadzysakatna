(()=>{var e={};e.id=453,e.ids=[453],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4946:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>l.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>f,tree:()=>o}),t(8810),t(413),t(5974),t(5866);var s=t(3191),a=t(8716),i=t(7922),l=t.n(i),n=t(5231),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);t.d(r,d);let o=["",{children:["driver",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,8810)),"C:\\kadztricy\\sakatna\\frontend\\app\\driver\\page.tsx"]}]},{loading:[()=>Promise.resolve().then(t.bind(t,413)),"C:\\kadztricy\\sakatna\\frontend\\app\\driver\\loading.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,5974)),"C:\\kadztricy\\sakatna\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\kadztricy\\sakatna\\frontend\\app\\driver\\page.tsx"],u="/driver/page",p={require:t,loadChunk:()=>Promise.resolve()},f=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/driver/page",pathname:"/driver",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},5160:(e,r,t)=>{Promise.resolve().then(t.bind(t,307))},5303:()=>{},307:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>j});var s=t(326),a=t(7577),i=t(772),l=t(3071),n=t(567),d=t(2631),o=t(7085),c=t(6507),u=t(7636),p=t(7650),f=t(361),m=t(434),x=t(7506);let g=(0,t(2881).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);function h({activeRide:e,rideCoords:r}){let t=(0,a.useRef)(null),[i,l]=(0,a.useState)(null),[n,d]=(0,a.useState)(null),[o,c]=(0,a.useState)(!0),[u,p]=(0,a.useState)(null),[f,m]=(0,a.useState)([]);return((0,a.useRef)(null),(0,a.useRef)(null),(0,a.useRef)([]),(0,a.useRef)(null),o)?s.jsx("div",{className:"h-64 bg-muted flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx(x.Z,{className:"h-8 w-8 text-primary mx-auto mb-2 animate-spin"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading map..."})]})}):(0,s.jsxs)("div",{className:"relative h-64 rounded-lg overflow-hidden",children:[s.jsx("div",{ref:t,className:"h-full w-full"}),u&&s.jsx("div",{className:"absolute top-2 left-2 right-2 bg-yellow-100 border border-yellow-300 text-yellow-800 px-3 py-2 rounded text-xs",children:u}),(0,s.jsxs)("div",{className:"absolute bottom-2 right-2 bg-white px-3 py-1.5 rounded-full shadow-md text-xs font-medium flex items-center gap-1.5",children:[s.jsx("div",{className:"w-2 h-2 bg-secondary rounded-full animate-pulse"}),"Live Tracking"]}),f.length>0&&!e&&(0,s.jsxs)("div",{className:"absolute top-2 left-2 bg-white px-3 py-1.5 rounded-full shadow-md text-xs font-medium flex items-center gap-1.5",children:[s.jsx(g,{className:"h-3 w-3 text-primary"}),f.length," Nearby"]})]})}var v=t(6824),b=t(2991),y=t(5047);function j(){let[e,r]=(0,a.useState)([]),[t,x]=(0,a.useState)([]),[g,j]=(0,a.useState)([]),[k,_]=(0,a.useState)(void 0),N=(0,b.vF)(),w=N?.driver_id||N?.user_id;(0,y.useRouter)();let C=async s=>{try{if(!w){alert("Driver id not found; ensure you are registered as a driver");return}if(t.length>0){alert("You have an active ride. Complete it before accepting a new request.");return}let a=e.find(e=>e.id===s)||null,i=await (0,v.v_)(`/bookings/${s}/assign/${w}`,{});if(r(e=>e.filter(e=>e.id!==s)),i&&i.booking){let e=i.booking,r={id:e.booking_id,passengerName:e.user_id||"Passenger",pickup:e.pickup_location||e.pickup||"",dropoff:e.dropoff_location||e.dropoff||"",fare:e.fare||0,status:"requested"===e.status?"pending":e.status,pickup_lat:e.pickup_lat??null,pickup_lng:e.pickup_lng??null,dropoff_lat:e.dropoff_lat??null,dropoff_lng:e.dropoff_lng??null};x(e=>[r,...e.filter(e=>e.id!==r.id)]),_({pickup_lat:r.pickup_lat??null,pickup_lng:r.pickup_lng??null,dropoff_lat:r.dropoff_lat??null,dropoff_lng:r.dropoff_lng??null})}else if(a)x(e=>[a,...e.filter(e=>e.id!==a.id)]),_({pickup_lat:a.pickup_lat??null,pickup_lng:a.pickup_lng??null,dropoff_lat:a.dropoff_lat??null,dropoff_lng:a.dropoff_lng??null});else try{let e=w?await (0,v.U2)(`/bookings/driver/${w}`):[];if(Array.isArray(e)){let r=e.map(e=>({id:e.booking_id,passengerName:e.user_id||"Passenger",pickup:e.pickup_location||e.pickup||"",dropoff:e.dropoff_location||e.dropoff||"",fare:e.fare||0,status:"requested"===e.status?"pending":e.status,pickup_lat:e.pickup_lat??null,pickup_lng:e.pickup_lng??null,dropoff_lat:e.dropoff_lat??null,dropoff_lng:e.dropoff_lng??null})),t=[],s=[],a=new Set;for(let e of r)a.has(e.id)||(a.add(e.id),"completed"===(e.status||"").toLowerCase()?s.push(e):t.push(e));x(t),j(s)}else x([]),j([])}catch(e){console.error("failed to refresh accepted bookings",e)}}catch(e){alert("Failed to accept booking: "+(e?.message||JSON.stringify(e)))}},P=e=>{r(r=>r.filter(r=>r.id!==e))};return(0,s.jsxs)(d.O,{children:[(0,s.jsxs)("header",{className:"bg-primary text-primary-foreground p-6 shadow-md",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Driver Dashboard"}),s.jsx(m.default,{href:"/notifications",children:s.jsx(i.z,{variant:"ghost",size:"icon",className:"text-primary-foreground hover:bg-primary-foreground/20",children:s.jsx(c.Z,{className:"h-5 w-5"})})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)(n.C,{variant:"secondary",className:"px-3 py-1",children:[t.length," Active rides"]}),(0,s.jsxs)(n.C,{variant:"outline",className:"px-3 py-1 bg-primary-foreground/10 text-primary-foreground border-primary-foreground/20",children:[g.length," Completed"]})]})]}),(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[s.jsx(l.Zb,{className:"shadow-lg overflow-hidden",children:s.jsx(h,{rideCoords:k||(t.length>0?(()=>{let e=t[0];return{pickup_lat:e.pickup_lat??null,pickup_lng:e.pickup_lng??null,dropoff_lat:e.dropoff_lat??null,dropoff_lng:e.dropoff_lng??null}})():void 0)})}),e.length>0&&(0,s.jsxs)("div",{className:"space-y-3",children:[s.jsx("h2",{className:"text-lg font-bold text-foreground",children:"New Requests"}),e.map(e=>(0,s.jsxs)(l.Zb,{className:"shadow-lg border-l-4 border-l-secondary",children:[s.jsx(l.Ol,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[s.jsx(l.ll,{className:"text-base",children:e.passengerName}),(0,s.jsxs)(n.C,{className:"bg-secondary text-secondary-foreground",children:["â‚±",e.fare]})]})}),(0,s.jsxs)(l.aY,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[s.jsx(u.Z,{className:"h-4 w-4 text-primary mt-0.5 flex-shrink-0"}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"font-medium text-muted-foreground",children:"Pickup"}),s.jsx("p",{className:"text-foreground",children:e.pickup})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[s.jsx(p.Z,{className:"h-4 w-4 text-secondary mt-0.5 flex-shrink-0"}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"font-medium text-muted-foreground",children:"Drop-off"}),s.jsx("p",{className:"text-foreground",children:e.dropoff})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 pt-2",children:[s.jsx(i.z,{onClick:()=>C(e.id),className:"flex-1",size:"sm",disabled:t.length>0,children:"Accept"}),s.jsx(i.z,{onClick:()=>P(e.id),variant:"outline",className:"flex-1",size:"sm",children:"Decline"})]})]})]},e.id))]}),t.length>0&&s.jsx("div",{className:"p-3 rounded bg-yellow-50 border border-yellow-200 text-sm text-yellow-800",children:"You have an active ride. Complete it before accepting new requests."}),0===e.length&&0===t.length&&s.jsx(l.Zb,{className:"shadow-lg",children:(0,s.jsxs)(l.aY,{className:"py-12 text-center",children:[s.jsx(f.Z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),s.jsx("p",{className:"text-muted-foreground",children:"No active booking requests"}),s.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"New requests will appear here"})]})})]}),s.jsx(o.L,{userType:"driver"})]})}},567:(e,r,t)=>{"use strict";t.d(r,{C:()=>d});var s=t(326);t(7577);var a=t(9469),i=t(9360),l=t(7863);let n=(0,i.j)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function d({className:e,variant:r,asChild:t=!1,...i}){let d=t?a.g7:"span";return s.jsx(d,{"data-slot":"badge",className:(0,l.cn)(n({variant:r}),e),...i})}},6507:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let s=(0,t(2881).Z)("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]])},361:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let s=(0,t(2881).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},413:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>l});var s=t(9510),a=t(382),i=t(9541);function l(){return s.jsx(a.O,{children:s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx(i.Z,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-4"}),s.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Loading driver dashboard..."}),s.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Please wait while we prepare your view"})]})})})}},8810:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(8570).createProxy)(String.raw`C:\kadztricy\sakatna\frontend\app\driver\page.tsx#default`)},382:(e,r,t)=>{"use strict";t.d(r,{O:()=>i});var s=t(9510),a=t(650);function i({children:e,className:r}){return s.jsx("div",{className:(0,a.cn)("min-h-screen bg-background pb-20",r),children:s.jsx("div",{className:"max-w-md mx-auto",children:e})})}},650:(e,r,t)=>{"use strict";t.d(r,{cn:()=>i});var s=t(5761),a=t(2386);function i(...e){return(0,a.m6)((0,s.W)(e))}}};var r=require("../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[637,710,404,819,648],()=>t(4946));module.exports=s})();
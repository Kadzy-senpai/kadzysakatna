(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[926],{5830:function(e,t,r){Promise.resolve().then(r.bind(r,5621))},5621:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var s=r(7437),n=r(2265),a=r(6070),i=r(5974),o=r(2869),c=r(6109),l=r(801),d=r(1047);let u=(0,r(9205).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var m=r(3774),f=r(7877),h=r(9116),x=r(6023);function v(){let[e,t]=(0,n.useState)([]),[r,v]=(0,n.useState)(!0),[g,p]=(0,n.useState)(null),b=(0,x.vF)();(0,n.useEffect)(()=>{let e=new AbortController,{signal:r}=e,s=(0,x.vF)();if(!s){t([]),v(!1);return}let n=!0;(async()=>{v(!0);try{let e=[];if("driver"===s.role){let t=s.driver_id||s.user_id;e=t?await (0,h.U2)("/bookings/driver/".concat(t)):[]}else e=await (0,h.U2)("/bookings");if(r.aborted||!n)return;let a=Array.isArray(e)?e:[];"driver"!==s.role&&(a=a.filter(e=>e.user_id===s.user_id)),a=a.sort((e,t)=>{let r=((null==e?void 0:e.status)||"").toLowerCase(),s=((null==t?void 0:t.status)||"").toLowerCase(),n="completed"===r?1:0,a="completed"===s?1:0;if(n!==a)return n-a;let i=(null==e?void 0:e.created_at)||(null==e?void 0:e.createdAt)||"",o=(null==t?void 0:t.created_at)||(null==t?void 0:t.createdAt)||"";return i===o?0:o.localeCompare(i)}),t(a)}catch(e){if((null==e?void 0:e.status)===401||(null==e?void 0:e.message)==="401"){window.location.href="/login";return}!r.aborted&&n&&t([])}!r.aborted&&n&&v(!1)})();let a=()=>{t([]),v(!1)};return window.addEventListener("tricy_logout",a),()=>{n=!1,e.abort(),window.removeEventListener("tricy_logout",a)}},[]);let y=e=>{switch(e){case"completed":return"bg-secondary text-secondary-foreground";case"ongoing":return"bg-primary text-primary-foreground";case"cancelled":return"bg-destructive text-destructive-foreground";default:return"bg-muted text-muted-foreground"}},j=e=>e?e.charAt(0).toUpperCase()+e.slice(1):"Unknown",w=async e=>{if(confirm("Are you sure you want to cancel this booking?")){p(e);try{await (0,h.v_)("/bookings/".concat(e,"/cancel"),{}),t(t=>t.filter(t=>t.booking_id!==e))}catch(e){alert("Failed to cancel booking"),console.error(e)}finally{p(null)}}},N=async e=>{if(confirm("Mark this ride as completed?")){p(e);try{var r;let s=await (0,h.v_)("/bookings/".concat(e,"/complete"),{}),n=(null===(r=s.booking)||void 0===r?void 0:r.status)||"completed";t(t=>t.map(t=>t.booking_id===e?{...t,status:n}:t));try{window.dispatchEvent(new CustomEvent("tricy_booking_updated",{detail:{booking_id:e,status:n}}))}catch(e){}}catch(e){alert("Failed to complete ride"),console.error(e)}finally{p(null)}}};return(0,s.jsxs)(c.O,{children:[(0,s.jsxs)("header",{className:"bg-primary text-primary-foreground p-6 shadow-md",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:(null==b?void 0:b.role)==="driver"?"Active Rides":"Booking History"}),(0,s.jsx)("p",{className:"text-primary-foreground/90 mt-1",children:(null==b?void 0:b.role)==="driver"?"View and complete your active rides":"View all your rides"})]}),(0,s.jsx)("div",{className:"p-6 space-y-4",children:r?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("div",{className:"h-24 bg-muted/30 rounded animate-pulse"}),(0,s.jsx)("div",{className:"h-24 bg-muted/30 rounded animate-pulse"})]}):0===e.length?(0,s.jsx)("p",{className:"text-center text-muted-foreground",children:"No bookings found."}):(()=>{let t=e.filter(e=>"completed"!==((null==e?void 0:e.status)||"").toLowerCase()),r=e.filter(e=>"completed"===((null==e?void 0:e.status)||"").toLowerCase());return(0,s.jsxs)("div",{className:"space-y-6",children:[t.length>0&&(0,s.jsxs)("section",{children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-foreground mb-3",children:"Active / In Progress"}),(0,s.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,s.jsxs)(a.Zb,{className:"shadow-lg",children:[(0,s.jsx)(a.Ol,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(a.ll,{className:"text-base",children:e.created_at?new Date(e.created_at).toLocaleTimeString():"—"}),(0,s.jsx)(i.C,{className:y(e.status),children:j(e.status)})]})}),(0,s.jsxs)(a.aY,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(d.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:e.created_at?new Date(e.created_at).toLocaleDateString():""})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(u,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:e.time||""})]})]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 text-primary mt-0.5 flex-shrink-0"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-muted-foreground",children:"Pickup"}),(0,s.jsx)("p",{className:"text-foreground",children:e.pickup_location||e.pickup||""})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(f.Z,{className:"h-4 w-4 text-secondary mt-0.5 flex-shrink-0"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-muted-foreground",children:"Drop-off"}),(0,s.jsx)("p",{className:"text-foreground",children:e.dropoff_location||e.dropoff||""})]})]})]}),(0,s.jsx)("div",{className:"pt-2 border-t border-border",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Fare"}),(0,s.jsxs)("span",{className:"text-lg font-bold text-foreground",children:["₱",e.fare]})]})}),(0,s.jsxs)("div",{className:"pt-2 flex items-center justify-between",children:["requested"===e.status&&(0,s.jsx)(o.z,{variant:"ghost",onClick:()=>w(e.booking_id),isLoading:g===e.booking_id,loadingText:"Cancelling...",className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:"Cancel booking"}),(null==b?void 0:b.role)==="driver"&&"completed"!==e.status&&(0,s.jsx)(o.z,{variant:"default",onClick:()=>N(e.booking_id),isLoading:g===e.booking_id,loadingText:"Completing...",className:"ml-auto",children:"Ride completed"})]})]})]},e.booking_id))})]}),t.length>0&&r.length>0&&(0,s.jsx)("div",{className:"py-2",children:(0,s.jsx)("div",{className:"border-t border-border"})}),r.length>0&&(0,s.jsxs)("section",{children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-muted-foreground mb-3",children:"Completed"}),(0,s.jsx)("div",{className:"space-y-4",children:r.map(e=>(0,s.jsxs)(a.Zb,{className:"shadow-lg",children:[(0,s.jsx)(a.Ol,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(a.ll,{className:"text-base",children:e.created_at?new Date(e.created_at).toLocaleTimeString():"—"}),(0,s.jsx)(i.C,{className:y(e.status),children:j(e.status)})]})}),(0,s.jsxs)(a.aY,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(d.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:e.created_at?new Date(e.created_at).toLocaleDateString():""})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(u,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:e.time||""})]})]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 text-primary mt-0.5 flex-shrink-0"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-muted-foreground",children:"Pickup"}),(0,s.jsx)("p",{className:"text-foreground",children:e.pickup_location||e.pickup||""})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(f.Z,{className:"h-4 w-4 text-secondary mt-0.5 flex-shrink-0"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-muted-foreground",children:"Drop-off"}),(0,s.jsx)("p",{className:"text-foreground",children:e.dropoff_location||e.dropoff||""})]})]})]}),(0,s.jsx)("div",{className:"pt-2 border-t border-border",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Fare"}),(0,s.jsxs)("span",{className:"text-lg font-bold text-foreground",children:["₱",e.fare]})]})})]})]},e.booking_id))})]})]})})()}),(0,s.jsx)(l.L,{})]})}},801:function(e,t,r){"use strict";r.d(t,{L:function(){return m}});var s=r(7437),n=r(7648),a=r(9376),i=r(7877),o=r(1047);let c=(0,r(9205).Z)("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);var l=r(8226),d=r(2369),u=r(4508);function m(e){let{userType:t}=e,r=(0,a.usePathname)(),m=t;if(!m)try{let e=localStorage.getItem("tricy_user"),t=e?JSON.parse(e):null;(null==t?void 0:t.role)&&(m=t.role)}catch(e){}let f="driver"===m?"/driver":"/passenger",h="driver"===m?"Active rides":"Bookings",x=[{href:f,icon:c,label:"Home"},{href:"/bookings",icon:"driver"===m?i.Z:o.Z,label:h},{href:"/transactions",icon:l.Z,label:"Transactions"},{href:"/profile",icon:d.Z,label:"Profile"}];return(0,s.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 bg-card border-t border-border shadow-lg z-50",children:(0,s.jsx)("div",{className:"max-w-md mx-auto flex justify-around items-center h-16 px-4",children:x.map(e=>{let t=e.icon,a=r===e.href;return(0,s.jsxs)(n.default,{href:e.href,className:(0,u.cn)("flex flex-col items-center justify-center gap-1 flex-1 h-full transition-colors",a?"text-primary":"text-muted-foreground"),children:[(0,s.jsx)(t,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-xs font-medium",children:e.label})]},e.href)})})})}},6109:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});var s=r(7437),n=r(4508);function a(e){let{children:t,className:r}=e;return(0,s.jsx)("div",{className:(0,n.cn)("min-h-screen bg-background pb-20",r),children:(0,s.jsx)("div",{className:"max-w-md mx-auto",children:t})})}},5974:function(e,t,r){"use strict";r.d(t,{C:function(){return c}});var s=r(7437);r(2265);var n=r(8482),a=r(535),i=r(4508);let o=(0,a.j)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:r,asChild:a=!1,...c}=e,l=a?n.g7:"span";return(0,s.jsx)(l,{"data-slot":"badge",className:(0,i.cn)(o({variant:r}),t),...c})}},2869:function(e,t,r){"use strict";r.d(t,{z:function(){return l}});var s=r(7437);r(2265);var n=r(8482),a=r(535),i=r(1817),o=r(4508);let c=(0,a.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:t,variant:r,size:a,asChild:l=!1,isLoading:d=!1,loadingText:u,children:m,...f}=e,h=l?n.g7:"button";return(0,s.jsx)(h,{"data-slot":"button",className:(0,o.cn)(c({variant:r,size:a,className:t}),d&&"cursor-wait","active:scale-95 transition-transform duration-75"),disabled:d||f.disabled,...f,children:d?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{className:"animate-spin"}),u||m]}):m})}},6070:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return a},aY:function(){return l},ll:function(){return o}});var s=r(7437);r(2265);var n=r(4508);function a(e){let{className:t,...r}=e;return(0,s.jsx)("div",{"data-slot":"card",className:(0,n.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function i(e){let{className:t,...r}=e;return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,n.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function o(e){let{className:t,...r}=e;return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,n.cn)("leading-none font-semibold",t),...r})}function c(e){let{className:t,...r}=e;return(0,s.jsx)("div",{"data-slot":"card-description",className:(0,n.cn)("text-muted-foreground text-sm",t),...r})}function l(e){let{className:t,...r}=e;return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,n.cn)("px-6",t),...r})}},9116:function(e,t,r){"use strict";r.d(t,{U2:function(){return i},r$:function(){return o},v_:function(){return a}});let s=r(257).env.NEXT_PUBLIC_API_BASE||"https://kadzysakatna.onrender.com";function n(){try{return localStorage.getItem("tricy_token")}catch(e){return null}}async function a(e,t){let r=n(),a={"Content-Type":"application/json"};r&&(a.Authorization="Bearer ".concat(r));let i=await fetch("".concat(s).concat(e),{method:"POST",headers:a,body:JSON.stringify(t)});if(401===i.status){try{localStorage.removeItem("tricy_token"),localStorage.removeItem("tricy_user"),window.dispatchEvent(new CustomEvent("tricy_logout"))}catch(e){}throw{message:"Unauthorized",status:401}}let o=await i.json().catch(()=>null);if(!i.ok)throw o||{message:i.statusText};return o}async function i(e){let t=n(),r={"Content-Type":"application/json"};t&&(r.Authorization="Bearer ".concat(t));let a=await fetch("".concat(s).concat(e),{headers:r});if(401===a.status){try{localStorage.removeItem("tricy_token"),localStorage.removeItem("tricy_user"),window.dispatchEvent(new CustomEvent("tricy_logout"))}catch(e){}throw{message:"Unauthorized",status:401}}let i=await a.json().catch(()=>null);if(!a.ok)throw i||{message:a.statusText};return i}async function o(e,t){let r=n(),a={"Content-Type":"application/json"};r&&(a.Authorization="Bearer ".concat(r));let i=await fetch("".concat(s).concat(e),{method:"PATCH",headers:a,body:JSON.stringify(t)});if(401===i.status){try{localStorage.removeItem("tricy_token"),localStorage.removeItem("tricy_user"),window.dispatchEvent(new CustomEvent("tricy_logout"))}catch(e){}throw{message:"Unauthorized",status:401}}let o=await i.json().catch(()=>null);if(!i.ok)throw o||{message:i.statusText};return o}},6023:function(e,t,r){"use strict";r.d(t,{M8:function(){return i},kS:function(){return a},vF:function(){return n}});var s=r(9116);function n(){let e=localStorage.getItem("tricy_user");return e?JSON.parse(e):null}function a(){localStorage.removeItem("tricy_token"),localStorage.removeItem("tricy_user"),window.dispatchEvent(new CustomEvent("tricy_logout"))}async function i(e){let t=n(),r=null!=e?e:null==t?void 0:t.user_id;if(!r)return null;try{return await (0,s.U2)("/users/".concat(r))}catch(e){return console.error("fetchUserFromApi",e),null}}},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var s=r(1994),n=r(3335);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,s.W)(t))}},1047:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},8226:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},1817:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},3774:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},7877:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]])},2369:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},7648:function(e,t,r){"use strict";r.d(t,{default:function(){return n.a}});var s=r(2972),n=r.n(s)},9376:function(e,t,r){"use strict";var s=r(5475);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[998,972,971,117,744],function(){return e(e.s=5830)}),_N_E=e.O()}]);